<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêØ –¢–∏–≥—Ä—ë–Ω–æ–∫ –≤ –ª–µ—Å—É - –ò–≥—Ä–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --primary-color: #2196f3;
            --success-color: #4caf50;
            --error-color: #f44336;
            --warning-color: #ff9800;
        }

        body.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #444444;
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            transition: background 0.3s;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            font-size: 2.5em;
            color: var(--primary-color);
            text-shadow: 1px 1px 0 rgba(33, 150, 243, 0.2);
            font-weight: 600;
            flex: 1;
            min-width: 300px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .theme-btn, .player-btn {
            padding: 10px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .theme-btn:hover, .player-btn:hover {
            transform: translateY(-2px);
            background: var(--primary-color);
            color: white;
        }

        .player-info {
            padding: 10px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            font-weight: 600;
            color: var(--primary-color);
            min-width: 200px;
            text-align: center;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .modal p {
            font-size: 1.1em;
            margin-bottom: 20px;
            color: var(--text-secondary);
        }

        .modal input {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            margin-bottom: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.3s;
        }

        .modal input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .modal-btn {
            padding: 15px 40px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .tab-btn:hover:not(.active) {
            transform: translateY(-2px);
            background: var(--bg-primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* –£—Ä–æ–≤–Ω–∏ */
        .levels {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .level-btn {
            padding: 14px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            min-width: 100px;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .level-btn.completed {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }

        .level-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            transform: scale(1.1);
            color: white;
        }

        .level-btn:hover {
            transform: translateY(-4px);
        }

        .level-icon {
            font-size: 28px;
            margin-bottom: 5px;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã */
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
        }

        /* –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
        .game-board {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 15px;
            border: 3px solid var(--primary-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #game-grid {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            gap: 4px;
            margin: 20px auto;
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
        }

        .cell {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            transition: all 0.3s;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            user-select: none;
            border: 2px solid var(--border-color);
        }

        .cell:hover {
            transform: scale(1.05);
        }

        .empty {
            background: var(--bg-primary);
        }

        .tiger {
            background: #ff9800;
            border-color: #f57c00;
            animation: bounce 0.8s infinite alternate;
        }

        .wall {
            background: #2e7d32;
            border-color: #1b5e20;
        }

        .tree {
            background: #388e3c;
            border-color: #2e7d32;
        }

        .meat {
            background: #ffb74d;
            border-color: #ffa726;
            animation: wiggle 1s infinite alternate;
        }

        .exit {
            background: #4caf50;
            border-color: #388e3c;
            animation: glow 2s infinite;
        }

        .key {
            background: #ffd54f;
            border-color: #ffca28;
            animation: sparkle 1.5s infinite alternate;
        }

        .door {
            background: #ba68c8;
            border-color: #ab47bc;
        }

        .locked-door {
            background: #ba68c8;
            border-color: #ab47bc;
            position: relative;
        }
        
        .locked-door::after {
            content: "üîí";
            position: absolute;
            font-size: 16px;
            bottom: 2px;
            right: 2px;
        }

        .paw {
            background: #ffcc80;
            border-color: #ffb74d;
        }

        /* –ü–∞–Ω–µ–ª—å –∫–æ–¥–∞ */
        .code-panel {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 15px;
            border: 3px solid var(--primary-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        /* –ó–∞–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è */
        .level-task {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
            font-size: 14px;
            line-height: 1.5;
        }

        .level-task h4 {
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 16px;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat {
            background: var(--bg-primary);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--border-color);
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat div:last-child {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 6px;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .button {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
            font-family: 'Segoe UI', sans-serif;
            color: white;
        }

        .button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .run-btn {
            background: var(--success-color);
            flex: 2;
        }

        .run-btn.running {
            background: var(--warning-color);
            animation: pulse 1s infinite;
        }

        .reset-btn {
            background: var(--error-color);
        }

        .undo-btn {
            background: #673ab7;
        }

        /* –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ */
        #code-input {
            width: 100%;
            height: 200px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 15px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            resize: none;
            margin-bottom: 15px;
            line-height: 1.6;
            transition: border-color 0.3s;
        }

        #code-input.error {
            border-color: var(--error-color);
            background: rgba(244, 67, 54, 0.1);
        }

        #code-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ —Å—Ç—Ä–µ–ª–∫–∞–º–∏ */
        .arrow-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
            justify-items: center;
            max-width: 200px;
            margin-left: auto;
            margin-right: auto;
        }

        .arrow-btn {
            padding: 14px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            min-width: 60px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .arrow-btn:hover {
            transform: scale(1.15);
            background: #1976d2;
        }

        .arrow-btn:active {
            transform: scale(0.95);
        }

        /* –¶–∏—Ñ—Ä—ã */
        .number-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin-bottom: 15px;
        }

        .num-btn {
            padding: 8px;
            background: var(--warning-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .num-btn:hover {
            transform: translateY(-2px);
            background: #f57c00;
        }

        /* –ö–æ–º–∞–Ω–¥—ã */
        .commands {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .cmd-btn {
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .cmd-btn:hover {
            transform: translateY(-2px);
            background: #1976d2;
        }

        .cmd-icon {
            font-size: 20px;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è –∫–æ–¥–∞ */
        .code-history {
            margin-top: 20px;
            padding: 15px;
            background: var(--bg-primary);
            border-radius: 10px;
            border: 2px solid var(--border-color);
            max-height: 150px;
            overflow-y: auto;
        }

        .code-history h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .history-item {
            padding: 8px;
            background: var(--bg-secondary);
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 12px;
            border-left: 3px solid var(--primary-color);
        }

        .history-time {
            color: var(--text-secondary);
            font-size: 11px;
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ */
        .hint {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid var(--primary-color);
            font-size: 13px;
        }

        .hint h4 {
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .hint p {
            margin: 6px 0;
            line-height: 1.4;
        }

        /* –°–æ–æ–±—â–µ–Ω–∏–µ */
        .message-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid var(--warning-color);
            z-index: 1001;
            min-width: 350px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .message-modal.active {
            display: block;
            animation: slideIn 0.3s;
        }

        .message-title {
            font-size: 1.8em;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .message-text {
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .ok-btn {
            padding: 12px 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ok-btn:hover {
            transform: translateY(-2px);
            background: #1976d2;
        }

        /* –ü–µ—Å–æ—á–Ω–∏—Ü–∞ */
        .sandbox-container {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 15px;
            border: 3px solid #7e57c2;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .sandbox-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .sandbox-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .sandbox-btn {
            padding: 10px 20px;
            background: #7e57c2;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sandbox-btn:hover {
            transform: translateY(-2px);
            background: #673ab7;
        }

        .sandbox-btn.green {
            background: var(--success-color);
        }

        .sandbox-btn.green:hover {
            background: #388e3c;
        }

        .sandbox-btn.orange {
            background: var(--warning-color);
        }

        .sandbox-btn.orange:hover {
            background: #f57c00;
        }

        .sandbox-btn.red {
            background: var(--error-color);
        }

        .sandbox-btn.red:hover {
            background: #d32f2f;
        }

        .size-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .size-btn {
            padding: 8px 12px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .size-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .size-btn:hover {
            background: var(--bg-secondary);
        }

        .object-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }

        .obj-btn {
            padding: 12px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: var(--text-primary);
        }

        .obj-btn:hover {
            transform: scale(1.05);
            background: var(--bg-secondary);
        }

        .obj-btn.active {
            border-color: #7e57c2;
            background: #ede7f6;
            transform: scale(1.05);
        }

        #sandbox-grid {
            display: grid;
            gap: 4px;
            margin: 20px auto;
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            touch-action: none;
            position: relative;
            justify-content: center;
        }

        .sandbox-cell {
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            user-select: none;
            touch-action: none;
            transition: all 0.2s;
            font-size: 24px;
        }

        .sandbox-cell:hover {
            transform: scale(1.05);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes bounce {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(-5px);
            }
        }

        @keyframes wiggle {
            0%, 100% {
                transform: rotate(-3deg);
            }
            50% {
                transform: rotate(3deg);
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 10px #4caf50;
            }
            50% {
                box-shadow: 0 0 20px #4caf50;
            }
        }

        @keyframes sparkle {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            header {
                flex-direction: column;
            }

            .game-layout {
                grid-template-columns: 1fr;
            }

            #game-grid {
                grid-template-columns: repeat(8, 50px);
                grid-template-rows: repeat(8, 50px);
                gap: 3px;
            }

            .cell {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .commands {
                grid-template-columns: repeat(2, 1fr);
            }

            .arrow-controls {
                grid-template-columns: repeat(3, 1fr);
            }

            .arrow-btn {
                min-width: 50px;
                min-height: 50px;
                font-size: 20px;
            }
        }

        /* –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ */
        .admin-btn {
            padding: 10px 20px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: block;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            background: #b71c1c;
        }

        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .admin-modal.active {
            display: flex;
        }

        .admin-modal-content {
            background: var(--bg-secondary);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.5s;
        }

        .admin-modal-content h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .admin-modal-content input {
            width: 100%;
            padding: 15px;
            font-size: 1em;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            margin-bottom: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .admin-modal-content button {
            padding: 12px 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.3s;
        }

        .admin-modal-content button:hover {
            transform: translateY(-2px);
            background: #1976d2;
        }

        .admin-panel-content {
            background: var(--bg-secondary);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.5s;
        }

        .admin-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .admin-panel-header h2 {
            font-size: 1.8em;
            color: var(--primary-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .close-btn:hover {
            transform: scale(1.2);
            color: var(--error-color);
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
        }

        .admin-tab-btn {
            padding: 10px 20px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .admin-tab-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .admin-tab-content {
            display: none;
            padding: 20px;
        }

        .admin-tab-content.active {
            display: block;
        }

        .admin-section {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
        }

        .admin-section h4 {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .admin-section input[type="file"] {
            margin-bottom: 10px;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            width: 100%;
        }

        .admin-section button {
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .admin-section button:hover {
            transform: translateY(-2px);
            background: #1976d2;
        }

        .admin-level-item,
        .admin-user-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--success-color);
        }

        .admin-level-item strong,
        .admin-user-item strong {
            font-size: 1.1em;
            color: var(--primary-color);
        }

        .admin-level-item p,
        .admin-user-item p {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin: 5px 0;
        }

        .admin-level-item button,
        .admin-user-item button {
            padding: 8px 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-right: 5px;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .admin-level-item button:hover,
        .admin-user-item button:hover {
            transform: translateY(-2px);
            background: #1976d2;
        }
    </style>
</head>
<body>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
    <div id="welcome-modal" class="modal active">
        <div class="modal-content">
            <h2>üêØ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <p>–ü–æ–º–æ–≥–∏ —Ç–∏–≥—Ä—ë–Ω–∫—É –Ω–∞–π—Ç–∏ –≤—ã—Ö–æ–¥ –∏–∑ –ª–µ—Å—É!</p>
            <p style="font-size: 0.9em; color: var(--text-secondary);">–í–≤–µ–¥–∏ —Å–≤–æ—ë –∏–º—è:</p>
            <input type="text" id="player-name" placeholder="–¢–≤–æ—ë –∏–º—è" maxlength="30">
            <button class="modal-btn" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É! üéÆ</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π -->
    <div id="message-modal" class="message-modal">
        <div class="message-title" id="msg-title">–£–†–ê! üéâ</div>
        <div class="message-text" id="msg-text"></div>
        <button class="ok-btn" onclick="closeMessage()">–ü–æ–Ω—è—Ç–Ω–æ!</button>
    </div>

    <div class="container">
        <header>
            <h1>üêØ –¢–∏–≥—Ä—ë–Ω–æ–∫ –≤ –ª–µ—Å—É</h1>
            <div class="header-controls">
                <button class="theme-btn" onclick="toggleTheme()">‚òÄÔ∏è –°–≤–µ—Ç / üåô –¢–µ–º–Ω–æ</button>
                <div class="player-info" id="player-info">–ò–≥—Ä–æ–∫: –ì–æ—Å—Ç—å</div>
                <button class="admin-btn" onclick="openAdminPanel()">üîê –ê–¥–º–∏–Ω</button>
            </div>
        </header>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('levels')">
                üéÆ –£—Ä–æ–≤–Ω–∏
            </button>
            <button class="tab-btn" onclick="switchTab('sandbox')">
                üèóÔ∏è –ü–µ—Å–æ—á–Ω–∏—Ü–∞
            </button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –£—Ä–æ–≤–Ω–∏ -->
        <div id="levels" class="tab-content active">
            <!-- –ò–∫–æ–Ω–∫–∏ —É—Ä–æ–≤–Ω–µ–π -->
            <div class="levels" id="level-buttons">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
            </div>

            <!-- –ò–≥—Ä–æ–≤–æ–π –ª–µ–π–∞—É—Ç -->
            <div class="game-layout">
                <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å - –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
                <div class="game-board">
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="score">0</div>
                            <div>–û—á–∫–∏</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="steps">0</div>
                            <div>–®–∞–≥–∏</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="meat">0/0</div>
                            <div>–ú—è—Å–æ üçñ</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="keys">0</div>
                            <div>–ö–ª—é—á–∏ üîë</div>
                        </div>
                    </div>

                    <div id="game-grid"></div>
                </div>

                <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                <div class="code-panel">
                    <!-- –ó–∞–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è -->
                    <div class="level-task" id="level-task">
                        <h4>üìã –ó–∞–¥–∞–Ω–∏–µ:</h4>
                        <div id="task-text"></div>
                    </div>

                    <div class="controls">
                        <button class="button run-btn" id="run-btn" onclick="runCode()">‚ñ∂ –ó–ê–ü–£–°–¢–ò–¢–¨</button>
                        <button class="button undo-btn" id="undo-btn" onclick="undoCommand()" disabled>‚Ü∂ –û–¢–ú–ï–ù–ò–¢–¨</button>
                        <button class="button reset-btn" id="reset-btn" onclick="resetGame()">üîÑ –°–ë–†–û–°</button>
                    </div>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª–∫–∞–º–∏ (—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∫ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ) -->
                    <div class="arrow-controls">
                        <div></div>
                        <button class="arrow-btn" onclick="addCommand('–≤–≤–µ—Ä—Ö()')" title="–≤–≤–µ—Ä—Ö()">
                            <span style="font-size: 28px;">‚Üë</span>
                        </button>
                        <div></div>
                        
                        <button class="arrow-btn" onclick="addCommand('–≤–ª–µ–≤–æ()')" title="–≤–ª–µ–≤–æ()">
                            <span style="font-size: 28px;">‚Üê</span>
                        </button>
                        <button class="arrow-btn" onclick="addCommand('–≤–Ω–∏–∑()')" title="–≤–Ω–∏–∑()">
                            <span style="font-size: 28px;">‚Üì</span>
                        </button>
                        <button class="arrow-btn" onclick="addCommand('–≤–ø—Ä–∞–≤–æ()')" title="–≤–ø—Ä–∞–≤–æ()">
                            <span style="font-size: 28px;">‚Üí</span>
                        </button>
                    </div>

                    <!-- –¶–∏—Ñ—Ä—ã –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–≥–æ–≤ -->
                    <div class="number-buttons">
                        <button class="num-btn" onclick="addNumber('1')">1</button>
                        <button class="num-btn" onclick="addNumber('2')">2</button>
                        <button class="num-btn" onclick="addNumber('3')">3</button>
                        <button class="num-btn" onclick="addNumber('4')">4</button>
                        <button class="num-btn" onclick="addNumber('5')">5</button>
                        <button class="num-btn" onclick="addNumber('6')">6</button>
                        <button class="num-btn" onclick="addNumber('7')">7</button>
                        <button class="num-btn" onclick="addNumber('8')">8</button>
                        <button class="num-btn" onclick="addNumber('9')">9</button>
                        <button class="num-btn" onclick="addNumber('0')">0</button>
                    </div>

                    <textarea id="code-input" placeholder="–ò–ª–∏ –Ω–∞–ø–∏—à–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É –≤—Ä—É—á–Ω—É—é..."></textarea>

                    <!-- –ö–æ–º–∞–Ω–¥—ã -->
                    <div class="commands">
                        <button class="cmd-btn" onclick="addCommand('–µ—Å—Ç—å()')">
                            <span class="cmd-icon">üçñ</span>
                            <span>–µ—Å—Ç—å()</span>
                        </button>
                        <button class="cmd-btn" onclick="addCommand('–≤–∑—è—Ç—å()')">
                            <span class="cmd-icon">üîë</span>
                            <span>–≤–∑—è—Ç—å()</span>
                        </button>
                        <button class="cmd-btn" onclick="addCommand('–æ—Ç–∫—Ä—ã—Ç—å()')">
                            <span class="cmd-icon">üö™</span>
                            <span>–æ—Ç–∫—Ä—ã—Ç—å()</span>
                        </button>
                        <button class="cmd-btn" onclick="clearCode()">
                            <span class="cmd-icon">üóëÔ∏è</span>
                            <span>–û—á–∏—Å—Ç–∏—Ç—å</span>
                        </button>
                    </div>

                    <!-- –ò—Å—Ç–æ—Ä–∏—è –∫–æ–¥–∞ -->
                    <div class="code-history" id="code-history">
                        <h4>üìú –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫:</h4>
                        <div id="history-list"></div>
                    </div>

                    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
                    <div class="hint">
                        <h4>üí° –í—Å–µ –∫–æ–º–∞–Ω–¥—ã:</h4>
                        <p><strong>–î–≤–∏–∂–µ–Ω–∏–µ:</strong></p>
                        <p>‚Ä¢ <code>–≤–ø—Ä–∞–≤–æ()</code> - –Ω–∞ 1 –∫–ª–µ—Ç–∫—É –≤–ø—Ä–∞–≤–æ</p>
                        <p>‚Ä¢ <code>–≤–ø—Ä–∞–≤–æ(3)</code> - –Ω–∞ 3 –∫–ª–µ—Ç–∫–∏ –≤–ø—Ä–∞–≤–æ (–Ω–∞–ø–∏—à–∏ —á–∏—Å–ª–æ –≤ —Å–∫–æ–±–∫–∏ –∏–ª–∏ –Ω–∞–∂–º–∏ —Ü–∏—Ñ—Ä—É!)</p>
                        <p>‚Ä¢ <code>–≤–ª–µ–≤–æ()</code>, <code>–≤–≤–µ—Ä—Ö()</code>, <code>–≤–Ω–∏–∑()</code> - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ</p>
                        <p><strong>–î–µ–π—Å—Ç–≤–∏—è:</strong></p>
                        <p>‚Ä¢ <code>üçñ –µ—Å—Ç—å()</code> - —Å—ä–µ—Å—Ç—å –º—è—Å–æ</p>
                        <p>‚Ä¢ <code>üîë –≤–∑—è—Ç—å()</code> - –≤–∑—è—Ç—å –∫–ª—é—á</p>
                        <p>‚Ä¢ <code>üö™ –æ—Ç–∫—Ä—ã—Ç—å()</code> - –æ—Ç–∫—Ä—ã—Ç—å –¥–≤–µ—Ä—å</p>
                        <p><strong>–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–µ–ª–∫–∏ ‚Üë‚Üì‚Üê‚Üí, —Ü–∏—Ñ—Ä—ã, –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ –ø–∏—à–∏ –∫–æ–¥ –≤—Ä—É—á–Ω—É—é!</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ü–µ—Å–æ—á–Ω–∏—Ü–∞ -->
        <div id="sandbox" class="tab-content">
            <div class="sandbox-container">
                <div class="sandbox-header">
                    <h2 style="color: #7e57c2; font-size: 24px;">üèóÔ∏è –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π</h2>
                    <div class="sandbox-controls">
                        <button class="sandbox-btn" onclick="uploadSandboxLevel()">
                            üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
                        </button>
                        <button class="sandbox-btn" onclick="downloadSandboxLevel()">
                            üì• –°–∫–∞—á–∞—Ç—å
                        </button>
                        <button class="sandbox-btn orange" onclick="playSandboxLevel()">
                            ‚ñ∂ –ò–≥—Ä–∞—Ç—å
                        </button>
                        <button class="sandbox-btn red" onclick="clearSandbox()">
                            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º –∫–ª–µ—Ç–æ–∫ -->
                <div class="size-controls">
                    <span>–†–∞–∑–º–µ—Ä –ø–æ–ª—è:</span>
                    <button class="size-btn" onclick="setSandboxSize(4)">4x4</button>
                    <button class="size-btn" onclick="setSandboxSize(6)">6x6</button>
                    <button class="size-btn active" onclick="setSandboxSize(8)">8x8</button>
                    <button class="size-btn" onclick="setSandboxSize(10)">10x10</button>
                    <button class="size-btn" onclick="setSandboxSize(12)">12x12</button>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ -->
                <div class="object-buttons">
                    <button class="obj-btn active" onclick="selectSandboxObject('tiger')">
                        üêØ<span>–¢–∏–≥—Ä—ë–Ω–æ–∫</span>
                    </button>
                    <button class="obj-btn" onclick="selectSandboxObject('exit')">
                        üü¢<span>–í—ã—Ö–æ–¥</span>
                    </button>
                    <button class="obj-btn" onclick="selectSandboxObject('wall')">
                        üß±<span>–°—Ç–µ–Ω–∞</span>
                    </button>
                    <button class="obj-btn" onclick="selectSandboxObject('tree')">
                        üå≥<span>–î–µ—Ä–µ–≤–æ</span>
                    </button>
                    <button class="obj-btn" onclick="selectSandboxObject('meat')">
                        üçñ<span>–ú—è—Å–æ</span>
                    </button>
                    <button class="obj-btn" onclick="selectSandboxObject('key')">
                        üîë<span>–ö–ª—é—á</span>
                    </button>
                    <button class="obj-btn" onclick="selectSandboxObject('door')">
                        üö™<span>–î–≤–µ—Ä—å</span>
                    </button>
                    <button class="obj-btn" onclick="selectSandboxObject('empty')">
                        üßπ<span>–û—á–∏—Å—Ç–∏—Ç—å</span>
                    </button>
                </div>

                <div style="text-align: center; margin-bottom: 15px; color: var(--text-secondary); font-size: 14px;">
                    <small>üí° –ó–∞–∂–º–∏ –ª–µ–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –∏ —Ç—è–Ω–∏, —á—Ç–æ–±—ã —Ä–∏—Å–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–µ—Ç–æ–∫!</small>
                </div>

                <div id="sandbox-grid"></div>

                <div class="hint">
                    <h4>üéØ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º:</h4>
                    <p>1. –í—ã–±–µ—Ä–∏ —Ä–∞–∑–º–µ—Ä –ø–æ–ª—è –∏ –æ–±—ä–µ–∫—Ç –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è</p>
                    <p>2. –ö–ª–∏–∫–Ω–∏ –Ω–∞ –∫–ª–µ—Ç–∫—É –∏–ª–∏ –∑–∞–∂–º–∏ –º—ã—à—å –∏ —Ç—è–Ω–∏</p>
                    <p>3. –°–æ—Ö—Ä–∞–Ω–∏ —É—Ä–æ–≤–µ–Ω—å –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–£—Ä–æ–≤–Ω–∏"</p>
                    <p>4. –ù–∞–∂–º–∏ "–ò–≥—Ä–∞—Ç—å" —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å</p>
                    <p>5. –ù–∞–∂–º–∏ "–°–∫–∞—á–∞—Ç—å" —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –≤ —Ñ–∞–π–ª –∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        let game = {
            level: 1,
            tiger: { x: 0, y: 0 },
            score: 0,
            steps: 0,
            meatCollected: 0,
            totalMeat: 0,
            keys: 0,
            objects: [],
            isRunning: false,
            completedLevels: new Set(),
            hasBeenRun: false,
            startPosition: { x: 0, y: 0 },
            moveHistory: [],
            codeHistory: [],
            isSandboxMode: false,
            sandboxLevelData: null
        };

        let sandbox = {
            selectedObject: 'tiger',
            objects: [],
            tigerPos: { x: 0, y: 0 },
            exitPos: { x: 7, y: 7 },
            isDrawing: false,
            lastCell: null,
            gridSize: 8,
            cellSize: 60
        };

        let playerName = '–ì–æ—Å—Ç—å';

        const levels = {
            1: {
                name: "–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏",
                start: { x: 0, y: 4 },
                exit: { x: 7, y: 4 },
                objects: [],
                task: "–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–µ–ª–∫—É ‚Üí –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É <code>–≤–ø—Ä–∞–≤–æ()</code> —á—Ç–æ–±—ã –¥–æ–π—Ç–∏ –¥–æ –≤—ã—Ö–æ–¥–∞."
            },
            2: {
                name: "–û–±—Ö–æ–¥ –¥–µ—Ä–µ–≤–∞",
                start: { x: 0, y: 4 },
                exit: { x: 7, y: 4 },
                objects: [
                    { type: 'tree', x: 3, y: 4 },
                    { type: 'tree', x: 4, y: 4 }
                ],
                task: "–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–µ–ª–∫–∏ ‚Üë –∏–ª–∏ ‚Üì —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ –¥–µ—Ä–µ–≤—å—è."
            },
            3: {
                name: "–õ–µ—Å–Ω–∞—è —Ç—Ä–æ–ø–∞",
                start: { x: 0, y: 7 },
                exit: { x: 7, y: 0 },
                objects: [
                    { type: 'tree', x: 2, y: 5 },
                    { type: 'tree', x: 2, y: 6 },
                    { type: 'tree', x: 5, y: 1 },
                    { type: 'tree', x: 5, y: 2 }
                ],
                task: "–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—ã —Å —á–∏—Å–ª–∞–º–∏: <code>–≤–ø—Ä–∞–≤–æ(2)</code>"
            },
            4: {
                name: "–í–∫—É—Å–Ω–æ–µ –º—è—Å–æ",
                start: { x: 0, y: 4 },
                exit: { x: 7, y: 4 },
                objects: [
                    { type: 'meat', x: 2, y: 4 },
                    { type: 'meat', x: 5, y: 4 },
                    { type: 'tree', x: 3, y: 4 },
                    { type: 'tree', x: 4, y: 4 }
                ],
                task: "–°—ä–µ—à—å –º—è—Å–æ üçñ –∫–æ–º–∞–Ω–¥–æ–π <code>–µ—Å—Ç—å()</code>"
            },
            5: {
                name: "–í–æ–ª—à–µ–±–Ω—ã–π –∫–ª—é—á",
                start: { x: 0, y: 4 },
                exit: { x: 7, y: 4 },
                objects: [
                    { type: 'key', x: 1, y: 4 },
                    { type: 'door', x: 4, y: 4, locked: true },
                    { type: 'meat', x: 6, y: 4 }
                ],
                task: "–í–æ–∑—å–º–∏ –∫–ª—é—á üîë <code>–≤–∑—è—Ç—å()</code> –∏ –æ—Ç–∫—Ä–æ–π –¥–≤–µ—Ä—å üö™ <code>–æ—Ç–∫—Ä—ã—Ç—å()</code>"
            },
            6: {
                name: "–ë–æ–ª—å—à–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ",
                start: { x: 0, y: 7 },
                exit: { x: 7, y: 0 },
                objects: [
                    { type: 'meat', x: 1, y: 6 },
                    { type: 'meat', x: 3, y: 4 },
                    { type: 'meat', x: 5, y: 2 },
                    { type: 'key', x: 2, y: 5 },
                    { type: 'door', x: 4, y: 3, locked: true },
                    { type: 'tree', x: 3, y: 2 },
                    { type: 'tree', x: 5, y: 5 }
                ],
                task: "–°–æ–±–µ—Ä–∏ –º—è—Å–æ, –≤–æ–∑—å–º–∏ –∫–ª—é—á –∏ –æ—Ç–∫—Ä–æ–π –¥–≤–µ—Ä—å!"
            }
        };

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´
        function startGame() {
            const nameInput = document.getElementById('player-name').value.trim();
            if (nameInput) playerName = nameInput;
            document.getElementById('welcome-modal').classList.remove('active');
            document.getElementById('player-info').textContent = `–ò–≥—Ä–æ–∫: ${playerName}`;
            initGame();
            createLevelButtons();
            
            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            trackUser(playerName, 1, 0);
        }

        function createLevelButtons() {
            const container = document.getElementById('level-buttons');
            container.innerHTML = '';
            const icons = ['üå±', 'üçÉ', 'üåø', 'üå≥', 'üîë', 'üèÜ'];
            for (let i = 1; i <= 6; i++) {
                const btn = document.createElement('button');
                btn.className = 'level-btn' + (i === 1 ? ' active' : '');
                if (game.completedLevels.has(i)) btn.classList.add('completed');
                btn.innerHTML = `<span class="level-icon">${icons[i - 1]}</span><span>–£—Ä–æ–≤–µ–Ω—å ${i}</span>`;
                btn.onclick = () => loadLevel(i);
                container.appendChild(btn);
            }
        }

        function initGame() {
            const level = game.isSandboxMode && game.sandboxLevelData ? 
                game.sandboxLevelData : 
                levels[game.level];
            
            game.tiger = { ...level.start };
            game.startPosition = { ...level.start };
            game.score = 0;
            game.steps = 0;
            game.meatCollected = 0;
            game.keys = 0;
            game.objects = [...level.objects];
            game.hasBeenRun = false;
            game.moveHistory = [];
            
            game.totalMeat = game.objects.filter(obj => obj.type === 'meat').length;
            renderBoard();
            updateStats();
            updateRunButton();
            updateTask();
        }

        function renderBoard() {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';
            const level = game.isSandboxMode && game.sandboxLevelData ? 
                game.sandboxLevelData : 
                levels[game.level];
            
            const size = game.isSandboxMode ? sandbox.gridSize : 8;
            const cellSize = game.isSandboxMode ? 50 : 60;

            grid.style.gridTemplateColumns = `repeat(${size}, ${cellSize}px)`;
            grid.style.gridTemplateRows = `repeat(${size}, ${cellSize}px)`;

            for (let y = 0; y < size; y++) {
                for (let x = 0; x < size; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell empty';
                    cell.id = `cell-${x}-${y}`;
                    cell.style.width = `${cellSize}px`;
                    cell.style.height = `${cellSize}px`;
                    cell.style.fontSize = `${cellSize * 0.4}px`;

                    const obj = game.objects.find(o => o.x === x && o.y === y);
                    const exit = level.exit;

                    if (x === exit.x && y === exit.y) {
                        cell.className = 'cell exit';
                        cell.textContent = 'üü¢';
                    } else if (obj) {
                        if (obj.type === 'door' && obj.locked) {
                            cell.className = 'cell locked-door';
                            cell.textContent = 'üö™';
                        } else {
                            cell.className = `cell ${obj.type}`;
                            switch (obj.type) {
                                case 'tree': cell.textContent = 'üå≥'; break;
                                case 'meat': cell.textContent = 'üçñ'; break;
                                case 'key': cell.textContent = 'üîë'; break;
                                case 'door': cell.textContent = 'üö™'; break;
                            }
                        }
                    } else if (x === game.tiger.x && y === game.tiger.y) {
                        cell.className = 'cell tiger';
                        cell.textContent = 'üêØ';
                    }
                    grid.appendChild(cell);
                }
            }
        }

        function updateStats() {
            document.getElementById('score').textContent = game.score;
            document.getElementById('steps').textContent = game.steps;
            document.getElementById('meat').textContent = `${game.meatCollected}/${game.totalMeat}`;
            document.getElementById('keys').textContent = game.keys;
        }

        function updateTask() {
            const taskElement = document.getElementById('task-text');
            if (game.isSandboxMode && game.sandboxLevelData) {
                taskElement.innerHTML = `
                    <span>üèóÔ∏è –£—Ä–æ–≤–µ–Ω—å –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ (${sandbox.gridSize}x${sandbox.gridSize})<br>
                    –ü—Ä–∏–¥—É–º–∞–π —Å–≤–æ—é –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è!</span>
                `;
            } else {
                const level = levels[game.level];
                taskElement.innerHTML = level.task;
            }
        }

        function updateRunButton() {
            const runBtn = document.getElementById('run-btn');
            const undoBtn = document.getElementById('undo-btn');

            if (game.hasBeenRun && !game.isRunning) {
                runBtn.disabled = true;
                runBtn.textContent = '‚ñ∂ –ù–ê–ñ–ú–ò "–°–ë–†–û–°"';
            } else if (game.isRunning) {
                runBtn.disabled = true;
                runBtn.classList.add('running');
                runBtn.textContent = 'üêæ –ò–î–Å–¢...';
            } else {
                runBtn.disabled = false;
                runBtn.classList.remove('running');
                runBtn.textContent = '‚ñ∂ –ó–ê–ü–£–°–¢–ò–¢–¨';
            }

            undoBtn.disabled = document.getElementById('code-input').value.length === 0 || game.isRunning;
        }

        function loadLevel(levelNum) {
            game.isSandboxMode = false;
            game.sandboxLevelData = null;
            
            document.querySelectorAll('.level-btn').forEach((btn, i) => {
                const levelIndex = i + 1;
                btn.classList.toggle('active', levelIndex === levelNum);
                btn.classList.toggle('completed', game.completedLevels.has(levelIndex));
            });

            game.level = levelNum;
            game.isRunning = false;
            game.hasBeenRun = false;
            initGame();
            updateRunButton();
            document.getElementById('code-input').value = '';
            document.getElementById('code-input').classList.remove('error');
        }

        // –ö–û–ú–ê–ù–î–´ –ò–ì–†–´
        function canMove(dx, dy) {
            const size = game.isSandboxMode ? sandbox.gridSize : 8;
            const newX = game.tiger.x + dx;
            const newY = game.tiger.y + dy;

            if (newX < 0 || newX >= size || newY < 0 || newY >= size) return false;

            const wall = game.objects.find(o => (o.type === 'wall' || o.type === 'tree') && o.x === newX && o.y === newY);
            if (wall) return false;

            const door = game.objects.find(o => o.type === 'door' && o.x === newX && o.y === newY);
            if (door && door.locked) return false;

            return true;
        }

        function move(dx, dy, count = 1) {
            for (let i = 0; i < count; i++) {
                if (!canMove(dx, dy)) {
                    const obj = game.objects.find(o => o.x === game.tiger.x + dx && o.y === game.tiger.y + dy);
                    if (obj && obj.type === 'door' && obj.locked) {
                        showMessage('–î–≤–µ—Ä—å –∑–∞–∫—Ä—ã—Ç–∞!', '–ù–∞–π–¥–∏ –∫–ª—é—á –∏ –æ—Ç–∫—Ä–æ–π –¥–≤–µ—Ä—å –∫–æ–º–∞–Ω–¥–æ–π –æ—Ç–∫—Ä—ã—Ç—å()');
                    } else {
                        showMessage('–û–π!', `–ù–µ –º–æ–≥—É –ø—Ä–æ–π—Ç–∏! –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –Ω–∞ —à–∞–≥–µ ${i + 1}.`);
                    }
                    return false;
                }

                const oldCell = document.getElementById(`cell-${game.tiger.x}-${game.tiger.y}`);
                const level = game.isSandboxMode && game.sandboxLevelData ? 
                    game.sandboxLevelData : 
                    levels[game.level];
                    
                if (!oldCell.classList.contains('exit')) {
                    oldCell.className = 'cell paw';
                    oldCell.textContent = 'üêæ';
                }

                game.tiger.x += dx;
                game.tiger.y += dy;
                game.steps++;

                const newCell = document.getElementById(`cell-${game.tiger.x}-${game.tiger.y}`);
                newCell.className = 'cell tiger';
                newCell.textContent = 'üêØ';

                updateStats();

                const exit = level.exit;
                if (game.tiger.x === exit.x && game.tiger.y === exit.y) {
                    setTimeout(checkWin, 500);
                    return true;
                }
            }
            return true;
        }

        function eat() {
            const meatIndex = game.objects.findIndex(o => o.type === 'meat' && o.x === game.tiger.x && o.y === game.tiger.y);
            if (meatIndex !== -1) {
                game.objects.splice(meatIndex, 1);
                game.score += 10;
                game.meatCollected++;
                const cell = document.getElementById(`cell-${game.tiger.x}-${game.tiger.y}`);
                cell.textContent = 'üêØ';
                updateStats();
                return true;
            }
            showMessage('–≠-—ç-—ç', '–ó–¥–µ—Å—å –Ω–µ—Ç –º—è—Å–∞!');
            return false;
        }

        function takeKey() {
            const keyIndex = game.objects.findIndex(o => o.type === 'key' && o.x === game.tiger.x && o.y === game.tiger.y);
            if (keyIndex !== -1) {
                game.objects.splice(keyIndex, 1);
                game.keys++;
                const cell = document.getElementById(`cell-${game.tiger.x}-${game.tiger.y}`);
                cell.textContent = 'üêØ';
                updateStats();
                return true;
            }
            showMessage('–û–π', '–ó–¥–µ—Å—å –Ω–µ—Ç –∫–ª—é—á–∞!');
            return false;
        }

        function openDoor() {
            const directions = [{dx: 1, dy: 0}, {dx: -1, dy: 0}, {dx: 0, dy: 1}, {dx: 0, dy: -1}];
            for (const dir of directions) {
                const doorIndex = game.objects.findIndex(o => o.type === 'door' && o.x === game.tiger.x + dir.dx && o.y === game.tiger.y + dir.dy);
                if (doorIndex !== -1) {
                    const door = game.objects[doorIndex];
                    if (door.locked) {
                        if (game.keys > 0) {
                            game.objects[doorIndex].locked = false;
                            game.keys--;
                            const doorCell = document.getElementById(`cell-${game.tiger.x + dir.dx}-${game.tiger.y + dir.dy}`);
                            doorCell.className = 'cell door';
                            doorCell.textContent = 'üö™';
                            updateStats();
                            showMessage('–î–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–∞!', '–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –¥–≤–µ—Ä—å!');
                            return true;
                        } else {
                            showMessage('–ù—É–∂–µ–Ω –∫–ª—é—á!', '–í–æ–∑—å–º–∏ –∫–ª—é—á —Å–Ω–∞—á–∞–ª–∞! –ë–µ–∑ –∫–ª—é—á–∞ –¥–≤–µ—Ä—å –Ω–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è!');
                            return false;
                        }
                    } else {
                        return true;
                    }
                }
            }
            showMessage('–†—è–¥–æ–º –Ω–µ—Ç –¥–≤–µ—Ä–∏', '–ü–æ–¥–æ–π–¥–∏ –±–ª–∏–∂–µ –∫ –¥–≤–µ—Ä–∏!');
            return false;
        }

        // –ó–ê–ü–£–°–ö –ü–†–û–ì–†–ê–ú–ú–´
        async function runCode() {
            if (game.isRunning || game.hasBeenRun) return;

            game.isRunning = true;
            game.hasBeenRun = true;
            updateRunButton();

            const code = document.getElementById('code-input').value;
            const codeInput = document.getElementById('code-input');
            codeInput.classList.remove('error');

            const now = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            game.codeHistory.unshift({
                code: code.substring(0, 50) + (code.length > 50 ? '...' : ''),
                time: now
            });
            if (game.codeHistory.length > 10) game.codeHistory.pop();
            updateCodeHistory();

            const lines = code.split('\n');

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                if (line === '' || line.startsWith('#')) continue;

                const success = await executeCommand(line);
                if (!success) {
                    game.isRunning = false;
                    game.hasBeenRun = true;
                    codeInput.classList.add('error');
                    updateRunButton();
                    return;
                }

                await sleep(500);
            }

            game.isRunning = false;
            updateRunButton();

            const level = game.isSandboxMode && game.sandboxLevelData ? 
                game.sandboxLevelData : 
                levels[game.level];
            const exit = level.exit;

            if (game.tiger.x !== exit.x || game.tiger.y !== exit.y) {
                showMessage('–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', '–ù–æ —Ç–∏–≥—Ä—ë–Ω–æ–∫ –µ—â—ë –Ω–µ —É –≤—ã—Ö–æ–¥–∞!');
            }
        }

        async function executeCommand(line) {
            // –ö–æ–º–∞–Ω–¥—ã —Å —á–∏—Å–ª–∞–º–∏: –≤–ø—Ä–∞–≤–æ(3)
            const withNumber = line.match(/^(–≤–ø—Ä–∞–≤–æ|–≤–ª–µ–≤–æ|–≤–≤–µ—Ä—Ö|–≤–Ω–∏–∑|—à–∞–≥|–≤–ø–µ—Ä–µ–¥)\((\d+)\)$/);
            
            if (withNumber) {
                const command = withNumber[1];
                const count = parseInt(withNumber[2]);

                if (count <= 0) {
                    showMessage('–û—à–∏–±–∫–∞!', `–ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0: "${line}"`);
                    return false;
                }

                switch (command) {
                    case '–≤–ø—Ä–∞–≤–æ':
                    case '—à–∞–≥':
                    case '–≤–ø–µ—Ä–µ–¥': return move(1, 0, count);
                    case '–≤–ª–µ–≤–æ': return move(-1, 0, count);
                    case '–≤–≤–µ—Ä—Ö': return move(0, -1, count);
                    case '–≤–Ω–∏–∑': return move(0, 1, count);
                    default: return false;
                }
            }

            // –ü—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å–æ —Å–∫–æ–±–∫–∞–º–∏: –∫–æ–º–∞–Ω–¥–∞()
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º [–∞-—è—ë–ê-–Ø–Å] –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä—É—Å—Å–∫–∏—Ö –±—É–∫–≤
            const commandMatch = line.match(/^([–∞-—è—ë–ê-–Ø–Å]+)\(\)$/);
            if (commandMatch) {
                const cmd = commandMatch[1];

                switch (cmd) {
                    case '–≤–ø—Ä–∞–≤–æ':
                    case '—à–∞–≥':
                    case '–≤–ø–µ—Ä–µ–¥': return move(1, 0);
                    case '–≤–ª–µ–≤–æ': return move(-1, 0);
                    case '–≤–≤–µ—Ä—Ö': return move(0, -1);
                    case '–≤–Ω–∏–∑': return move(0, 1);
                    case '–µ—Å—Ç—å': return eat();
                    case '–≤–∑—è—Ç—å': return takeKey();
                    case '–æ—Ç–∫—Ä—ã—Ç—å': return openDoor();
                    default:
                        showMessage('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞', `"${cmd}" ‚Äî –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞!`);
                        return false;
                }
            }

            // –ö–æ–º–∞–Ω–¥—ã –±–µ–∑ —Å–∫–æ–±–æ–∫: –ø—Ä–æ—Å—Ç–æ –≤–Ω–∏–∑, –≤–ø—Ä–∞–≤–æ –∏ —Ç.–¥.
            const simpleCmd = line.match(/^(–≤–ø—Ä–∞–≤–æ|–≤–ª–µ–≤–æ|–≤–≤–µ—Ä—Ö|–≤–Ω–∏–∑|–µ—Å—Ç—å|–≤–∑—è—Ç—å|–æ—Ç–∫—Ä—ã—Ç—å|—à–∞–≥|–≤–ø–µ—Ä–µ–¥)$/);
            if (simpleCmd) {
                const cmd = simpleCmd[1];
                switch (cmd) {
                    case '–≤–ø—Ä–∞–≤–æ':
                    case '—à–∞–≥':
                    case '–≤–ø–µ—Ä–µ–¥': return move(1, 0);
                    case '–≤–ª–µ–≤–æ': return move(-1, 0);
                    case '–≤–≤–µ—Ä—Ö': return move(0, -1);
                    case '–≤–Ω–∏–∑': return move(0, 1);
                    case '–µ—Å—Ç—å': return eat();
                    case '–≤–∑—è—Ç—å': return takeKey();
                    case '–æ—Ç–∫—Ä—ã—Ç—å': return openDoor();
                }
            }

            showMessage('–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞', `–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã: "${line}"\n–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: –∫–æ–º–∞–Ω–¥–∞() –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞(—á–∏—Å–ª–æ) –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∫–æ–º–∞–Ω–¥–∞`);
            return false;
        }

        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function addCommand(cmd) {
            const editor = document.getElementById('code-input');
            const cursorPos = editor.selectionStart;
            const textBefore = editor.value.substring(0, cursorPos);
            const textAfter = editor.value.substring(cursorPos);

            const prefix = (textBefore.trim() !== '' && !textBefore.endsWith('\n')) ? '\n' : '';
            editor.value = textBefore + prefix + cmd + textAfter;

            const newPos = cursorPos + prefix.length + cmd.length;
            editor.setSelectionRange(newPos, newPos);
            editor.focus();
            editor.classList.remove('error');
            updateRunButton();
        }

        function addNumber(num) {
            const editor = document.getElementById('code-input');
            const cursorPos = editor.selectionStart;
            const textBefore = editor.value.substring(0, cursorPos);
            const textAfter = editor.value.substring(cursorPos);

            const lines = textBefore.split('\n');
            const currentLine = lines[lines.length - 1];
            const commandMatch = currentLine.match(/(–≤–ø—Ä–∞–≤–æ|–≤–ª–µ–≤–æ|–≤–≤–µ—Ä—Ö|–≤–Ω–∏–∑)\(\)$/);

            if (commandMatch) {
                const command = commandMatch[1];
                const lineStart = textBefore.lastIndexOf('\n') + 1;
                const beforeCommand = textBefore.substring(0, lineStart);
                const newText = beforeCommand + command + '(' + num + ')' + textAfter;
                editor.value = newText;
                editor.setSelectionRange(newText.length - textAfter.length, newText.length - textAfter.length);
            } else {
                editor.value = textBefore + num + textAfter;
                editor.setSelectionRange(cursorPos + 1, cursorPos + 1);
            }

            editor.focus();
            editor.classList.remove('error');
            updateRunButton();
        }

        function undoCommand() {
            const editor = document.getElementById('code-input');
            if (editor.value.length === 0) return;
            
            editor.value = editor.value.slice(0, -1);
            editor.focus();
            editor.classList.remove('error');
            updateRunButton();
        }

        function clearCode() {
            document.getElementById('code-input').value = '';
            document.getElementById('code-input').classList.remove('error');
            updateRunButton();
        }

        function resetGame() {
            game.isRunning = false;
            game.hasBeenRun = false;
            game.moveHistory = [];

            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                if (cell.classList.contains('paw')) {
                    cell.className = 'cell empty';
                    cell.textContent = '';
                }
            });

            game.tiger = { ...game.startPosition };
            initGame();
            document.getElementById('code-input').classList.remove('error');
            updateRunButton();
        }

        function updateCodeHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            game.codeHistory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `<div>${item.code}</div><div class="history-time">${item.time}</div>`;
                historyList.appendChild(div);
            });
        }

        function checkWin() {
            const level = game.isSandboxMode && game.sandboxLevelData ? 
                game.sandboxLevelData : 
                levels[game.level];
            
            if (!game.isSandboxMode) {
                game.completedLevels.add(game.level);
            }

            const meatBonus = (game.meatCollected === game.totalMeat) ? 50 : 0;
            const stepBonus = Math.max(0, 100 - game.steps * 2);
            const totalBonus = meatBonus + stepBonus;

            game.score += totalBonus;
            updateStats();

            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
            trackCompletedLevel(playerName, game.level);

            setTimeout(() => {
                showMessage(
                    `–ú–æ–ª–æ–¥–µ—Ü, ${playerName}! üéâ`,
                    `–¢–∏–≥—Ä—ë–Ω–æ–∫ –ø—Ä–æ—à—ë–ª —É—Ä–æ–≤–µ–Ω—å!<br><br>üçñ –ú—è—Å–∞: ${game.meatCollected}/${game.totalMeat}<br>üêæ –®–∞–≥–æ–≤: ${game.steps}<br>‚≠ê –ë–æ–Ω—É—Å—ã: +${totalBonus}<br>üèÜ –í—Å–µ–≥–æ: ${game.score}`
                );
            }, 500);

            if (!game.isSandboxMode) {
                document.querySelectorAll('.level-btn').forEach((btn, i) => {
                    const levelIndex = i + 1;
                    if (game.completedLevels.has(levelIndex)) {
                        btn.classList.add('completed');
                    }
                });
            }
        }

        // –ü–ï–°–û–ß–ù–ò–¶–ê
        function initSandbox() {
            const grid = document.getElementById('sandbox-grid');
            grid.innerHTML = '';
            
            grid.style.gridTemplateColumns = `repeat(${sandbox.gridSize}, ${sandbox.cellSize}px)`;
            grid.style.gridTemplateRows = `repeat(${sandbox.gridSize}, ${sandbox.cellSize}px)`;
            
            let isMouseDown = false;
            
            grid.addEventListener('mousedown', function(e) {
                isMouseDown = true;
                sandbox.isDrawing = true;
                const cell = e.target.closest('.sandbox-cell');
                if (cell) {
                    handleSandboxClick(cell);
                }
            });
            
            grid.addEventListener('mousemove', function(e) {
                if (isMouseDown && sandbox.isDrawing) {
                    const cell = e.target.closest('.sandbox-cell');
                    if (cell) {
                        handleSandboxClick(cell);
                    }
                }
            });
            
            document.addEventListener('mouseup', function() {
                isMouseDown = false;
                sandbox.isDrawing = false;
                sandbox.lastCell = null;
            });
            
            for (let y = 0; y < sandbox.gridSize; y++) {
                for (let x = 0; x < sandbox.gridSize; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'sandbox-cell empty';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    cell.style.width = `${sandbox.cellSize}px`;
                    cell.style.height = `${sandbox.cellSize}px`;
                    
                    cell.addEventListener('click', function(e) {
                        if (!sandbox.isDrawing) {
                            const x = parseInt(this.dataset.x);
                            const y = parseInt(this.dataset.y);
                            placeSandboxObject(x, y);
                        }
                    });
                    
                    grid.appendChild(cell);
                }
            }
            updateSandbox();
        }
        
        function handleSandboxClick(cell) {
            const x = parseInt(cell.dataset.x);
            const y = parseInt(cell.dataset.y);
            placeSandboxObject(x, y);
        }
        
        function setSandboxSize(size) {
            sandbox.gridSize = size;
            
            if (size <= 6) {
                sandbox.cellSize = 70;
            } else if (size <= 10) {
                sandbox.cellSize = 50;
            } else {
                sandbox.cellSize = 40;
            }
            
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            sandbox.tigerPos = {x: 0, y: 0};
            sandbox.exitPos = {x: size-1, y: size-1};
            sandbox.objects = [];
            
            initSandbox();
        }
        
        function selectSandboxObject(objectType) {
            sandbox.selectedObject = objectType;
            sandbox.isDrawing = false;
            
            document.querySelectorAll('.obj-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
        }
        
        function placeSandboxObject(x, y) {
            if (sandbox.selectedObject === 'tiger') {
                sandbox.tigerPos = {x, y};
            } else if (sandbox.selectedObject === 'exit') {
                sandbox.exitPos = {x, y};
            } else if (sandbox.selectedObject === 'empty') {
                sandbox.objects = sandbox.objects.filter(obj => !(obj.x === x && obj.y === y));
                if (sandbox.tigerPos.x === x && sandbox.tigerPos.y === y) {
                    sandbox.tigerPos = {x: 0, y: 0};
                }
                if (sandbox.exitPos.x === x && sandbox.exitPos.y === y) {
                    sandbox.exitPos = {x: sandbox.gridSize-1, y: sandbox.gridSize-1};
                }
            } else if (sandbox.selectedObject !== 'tiger' && sandbox.selectedObject !== 'exit') {
                if ((sandbox.tigerPos.x === x && sandbox.tigerPos.y === y) || 
                    (sandbox.exitPos.x === x && sandbox.exitPos.y === y)) {
                    return;
                }
                
                const existingIndex = sandbox.objects.findIndex(obj => obj.x === x && obj.y === y);
                if (existingIndex !== -1) {
                    sandbox.objects[existingIndex].type = sandbox.selectedObject;
                } else {
                    sandbox.objects.push({
                        type: sandbox.selectedObject,
                        x: x,
                        y: y
                    });
                }
            }
            updateSandbox();
        }
        
        function updateSandbox() {
            const cells = document.querySelectorAll('.sandbox-cell');
            cells.forEach(cell => {
                const x = parseInt(cell.dataset.x);
                const y = parseInt(cell.dataset.y);
                
                cell.className = 'sandbox-cell empty';
                cell.textContent = '';
                cell.style.background = '';
                cell.style.borderColor = '';
                
                if (sandbox.tigerPos.x === x && sandbox.tigerPos.y === y) {
                    cell.textContent = 'üêØ';
                    cell.style.background = '#ff9800';
                    cell.style.borderColor = '#f57c00';
                } else if (sandbox.exitPos.x === x && sandbox.exitPos.y === y) {
                    cell.textContent = 'üü¢';
                    cell.style.background = '#4caf50';
                    cell.style.borderColor = '#388e3c';
                } else {
                    const obj = sandbox.objects.find(o => o.x === x && o.y === y);
                    if (obj) {
                        switch(obj.type) {
                            case 'wall': 
                                cell.textContent = 'üß±';
                                cell.style.background = '#2e7d32';
                                cell.style.borderColor = '#1b5e20';
                                break;
                            case 'tree': 
                                cell.textContent = 'üå≥';
                                cell.style.background = '#388e3c';
                                cell.style.borderColor = '#2e7d32';
                                break;
                            case 'meat': 
                                cell.textContent = 'üçñ';
                                cell.style.background = '#ffb74d';
                                cell.style.borderColor = '#ffa726';
                                break;
                            case 'key': 
                                cell.textContent = 'üîë';
                                cell.style.background = '#ffd54f';
                                cell.style.borderColor = '#ffca28';
                                break;
                            case 'door': 
                                cell.textContent = 'üö™';
                                cell.style.background = '#ba68c8';
                                cell.style.borderColor = '#ab47bc';
                                break;
                        }
                    } else {
                        cell.style.background = '';
                        cell.style.borderColor = '';
                    }
                }
            });
        }
        
        function clearSandbox() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä? –í—Å–µ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
                sandbox.objects = [];
                sandbox.tigerPos = {x: 0, y: 0};
                sandbox.exitPos = {x: sandbox.gridSize-1, y: sandbox.gridSize-1};
                sandbox.selectedObject = 'tiger';
                updateSandbox();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –æ–±—ä–µ–∫—Ç–∞
                document.querySelectorAll('.obj-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.obj-btn[onclick="selectSandboxObject(\'tiger\')"]').classList.add('active');
                
                console.log('–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ—á–∏—â–µ–Ω');
                showMessage('‚úÖ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ—á–∏—â–µ–Ω', '–ü–∞–Ω–µ–ª—å –æ—á–∏—â–µ–Ω–∞. –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!');
            }
        }
        
        function playSandboxLevel() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–∏–≥—Ä—ë–Ω–æ–∫ –∏ –≤—ã—Ö–æ–¥ –Ω–µ –≤ –æ–¥–Ω–æ–π –∫–ª–µ—Ç–∫–µ
            if (sandbox.tigerPos.x === sandbox.exitPos.x && sandbox.tigerPos.y === sandbox.exitPos.y) {
                showMessage('‚ùå –û—à–∏–±–∫–∞', '–¢–∏–≥—Ä—ë–Ω–æ–∫ –∏ –≤—ã—Ö–æ–¥ –Ω–µ –º–æ–≥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –æ–¥–Ω–æ–π –∫–ª–µ—Ç–∫–µ!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–∏–≥—Ä—ë–Ω–æ–∫ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–±—ä–µ–∫—Ç–æ–º
            const tigerOnObject = sandbox.objects.find(obj => obj.x === sandbox.tigerPos.x && obj.y === sandbox.tigerPos.y);
            if (tigerOnObject) {
                showMessage('‚ùå –û—à–∏–±–∫–∞', '–¢–∏–≥—Ä—ë–Ω–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –æ–±—ä–µ–∫—Ç–µ!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã—Ö–æ–¥ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–±—ä–µ–∫—Ç–æ–º
            const exitOnObject = sandbox.objects.find(obj => obj.x === sandbox.exitPos.x && obj.y === sandbox.exitPos.y);
            if (exitOnObject) {
                showMessage('‚ùå –û—à–∏–±–∫–∞', '–í—ã—Ö–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –æ–±—ä–µ–∫—Ç–µ!');
                return;
            }
            
            const levelData = {
                name: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä',
                start: sandbox.tigerPos,
                exit: sandbox.exitPos,
                objects: [...sandbox.objects],
                hint: '–£—Ä–æ–≤–µ–Ω—å —Å–æ–∑–¥–∞–Ω –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ!',
                gridSize: sandbox.gridSize
            };
            
            console.log('–ó–∞–ø—É—Å–∫–∞—é —É—Ä–æ–≤–µ–Ω—å –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:', levelData);
            
            switchTab('levels');
            
            game.isSandboxMode = true;
            game.sandboxLevelData = levelData;
            game.level = 0;
            game.isRunning = false;
            game.hasBeenRun = false;
            
            initGame();
            updateRunButton();
            
            document.getElementById('code-input').value = '';
            game.codeHistory = [];
            updateCodeHistory();
            
            showMessage('‚úÖ –£—Ä–æ–≤–µ–Ω—å –∑–∞–ø—É—â–µ–Ω!', '–¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è —Ç–∏–≥—Ä—ë–Ω–∫–∞ –∏ –Ω–∞–∂–º–∏ "–ó–ê–ü–£–°–¢–ò–¢–¨".');
        }
        
        function uploadSandboxLevel() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                console.log('–ó–∞–≥—Ä—É–∂–∞—é —Ñ–∞–π–ª:', file.name);
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        console.log('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:', event.target.result);
                        
                        const levelData = JSON.parse(event.target.result);
                        console.log('–†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', levelData);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
                        if (!levelData.start) {
                            showMessage('‚ùå –û—à–∏–±–∫–∞', '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ "start" (–Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —Ç–∏–≥—Ä–∞)');
                            return;
                        }
                        if (!levelData.exit) {
                            showMessage('‚ùå –û—à–∏–±–∫–∞', '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ "exit" (–ø–æ–∑–∏—Ü–∏—è –≤—ã—Ö–æ–¥–∞)');
                            return;
                        }
                        if (!levelData.objects) {
                            showMessage('‚ùå –û—à–∏–±–∫–∞', '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ "objects" (–æ–±—ä–µ–∫—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ)');
                            return;
                        }
                        if (!levelData.gridSize) {
                            showMessage('‚ùå –û—à–∏–±–∫–∞', '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ "gridSize" (—Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏)');
                            return;
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ start –∏ exit - —ç—Ç–æ –æ–±—ä–µ–∫—Ç—ã —Å x –∏ y
                        if (typeof levelData.start.x !== 'number' || typeof levelData.start.y !== 'number') {
                            showMessage('‚ùå –û—à–∏–±–∫–∞', '–ü–æ–ª–µ "start" –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å x –∏ y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã');
                            return;
                        }
                        if (typeof levelData.exit.x !== 'number' || typeof levelData.exit.y !== 'number') {
                            showMessage('‚ùå –û—à–∏–±–∫–∞', '–ü–æ–ª–µ "exit" –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å x –∏ y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã');
                            return;
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ objects - —ç—Ç–æ –º–∞—Å—Å–∏–≤
                        if (!Array.isArray(levelData.objects)) {
                            showMessage('‚ùå –û—à–∏–±–∫–∞', '–ü–æ–ª–µ "objects" –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º');
                            return;
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ gridSize - —ç—Ç–æ —á–∏—Å–ª–æ
                        if (typeof levelData.gridSize !== 'number' || levelData.gridSize < 4 || levelData.gridSize > 12) {
                            showMessage('‚ùå –û—à–∏–±–∫–∞', '–†–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 4 –¥–æ 12');
                            return;
                        }
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–≤–µ–Ω—å
                        sandbox.gridSize = levelData.gridSize;
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏
                        if (sandbox.gridSize <= 6) {
                            sandbox.cellSize = 70;
                        } else if (sandbox.gridSize <= 10) {
                            sandbox.cellSize = 50;
                        } else {
                            sandbox.cellSize = 40;
                        }
                        
                        sandbox.tigerPos = levelData.start;
                        sandbox.exitPos = levelData.exit;
                        sandbox.objects = levelData.objects || [];
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ä–∞–∑–º–µ—Ä–∞
                        document.querySelectorAll('.size-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        document.querySelector(`.size-btn[onclick="setSandboxSize(${sandbox.gridSize})"]`).classList.add('active');
                        
                        // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É
                        initSandbox();
                        
                        console.log('–£—Ä–æ–≤–µ–Ω—å —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω');
                        showMessage('‚úÖ –£—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∂–µ–Ω!', `–£—Ä–æ–≤–µ–Ω—å "${levelData.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!\n\n–†–∞–∑–º–µ—Ä: ${levelData.gridSize}x${levelData.gridSize}\n–û–±—ä–µ–∫—Ç–æ–≤: ${levelData.objects.length}`);
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', e);
                        showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ', `–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª:\n\n${e.message}\n\n–£–±–µ–¥–∏—Å—å, —á—Ç–æ —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π JSON —Ñ–∞–π–ª —É—Ä–æ–≤–Ω—è —Å –ø–æ–ª—è–º–∏: start, exit, objects, gridSize`);
                    }
                };
                
                reader.onerror = function(error) {
                    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                    showMessage('‚ùå –û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.');
                };
                
                reader.readAsText(file);
            };
            input.click();
        }
        
        function downloadSandboxLevel() {
            const levelName = prompt('–ù–∞–∑–æ–≤–∏ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å:', '–ú–æ–π —É—Ä–æ–≤–µ–Ω—å') || '–ú–æ–π —É—Ä–æ–≤–µ–Ω—å';
            
            const levelData = {
                name: levelName,
                start: sandbox.tigerPos,
                exit: sandbox.exitPos,
                objects: [...sandbox.objects],
                hint: '–£—Ä–æ–≤–µ–Ω—å —Å–æ–∑–¥–∞–Ω –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ!',
                gridSize: sandbox.gridSize,
                isSandboxLevel: true,
                savedAt: new Date().toISOString()
            };
            
            try {
                const blob = new Blob([JSON.stringify(levelData, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `—É—Ä–æ–≤–µ–Ω—å_${levelName.replace(/\s+/g, '_')}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('–£—Ä–æ–≤–µ–Ω—å —Å–∫–∞—á–∞–Ω:', a.download);
                showMessage('‚úÖ –£—Ä–æ–≤–µ–Ω—å —Å–∫–∞—á–∞–Ω!', `–§–∞–π–ª "${a.download}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä.\n\n–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–ª–∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏!`);
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏:', e);
                showMessage('‚ùå –û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.');
            }
        }

        // –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò
        function showMessage(title, text) {
            document.getElementById('msg-title').textContent = title;
            document.getElementById('msg-text').innerHTML = text.replace(/\n/g, '<br>');
            document.getElementById('message-modal').classList.add('active');
        }

        function closeMessage() {
            document.getElementById('message-modal').classList.remove('active');
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab-btn[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            if (tabName === 'sandbox') {
                setTimeout(initSandbox, 10);
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        window.onload = function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
            }

            const nameInput = document.getElementById('player-name');
            nameInput.focus();
            nameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') startGame();
            });
            
            initSandbox();
            initAdminPanel();
        };

        // ===== –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ =====
        const ADMIN_PASSWORD = "admin123";
        const ADMIN_KEY = "tiger_admin_logged_in";

        function initAdminPanel() {
            const isLoggedIn = sessionStorage.getItem(ADMIN_KEY);
            if (!isLoggedIn) {
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            } else {
                document.querySelector('.admin-btn').style.display = 'block';
            }
        }

        function openAdminPanel() {
            const isLoggedIn = sessionStorage.getItem(ADMIN_KEY);
            if (!isLoggedIn) {
                showAdminLoginModal();
                return;
            }
            showAdminPanelContent();
        }

        function showAdminLoginModal() {
            const modal = document.createElement('div');
            modal.id = 'admin-login-modal';
            modal.className = 'admin-modal active';
            modal.innerHTML = `
                <div class="admin-modal-content">
                    <h2>üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                    <p>–í–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞</p>
                    <input type="password" id="admin-password" placeholder="–ü–∞—Ä–æ–ª—å" />
                    <button onclick="adminLogin()">–í–æ–π—Ç–∏</button>
                    <button onclick="closeAdminLogin()" style="background: #999;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('admin-password').focus();
        }

        function adminLogin() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem(ADMIN_KEY, 'true');
                document.querySelector('.admin-btn').style.display = 'block';
                const modal = document.getElementById('admin-login-modal');
                if (modal) modal.remove();
                showAdminPanelContent();
            } else {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                document.getElementById('admin-password').value = '';
            }
        }

        function closeAdminLogin() {
            const modal = document.getElementById('admin-login-modal');
            if (modal) modal.remove();
        }

        function showAdminPanelContent() {
            const panel = document.createElement('div');
            panel.id = 'admin-panel-modal';
            panel.className = 'admin-modal active';
            panel.innerHTML = `
                <div class="admin-panel-content">
                    <div class="admin-panel-header">
                        <h2>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                        <button onclick="closeAdminPanel()" class="close-btn">‚úï</button>
                    </div>
                    
                    <div class="admin-tabs">
                        <button class="admin-tab-btn active" onclick="switchAdminTab('levels')">üìã –£—Ä–æ–≤–Ω–∏</button>
                        <button class="admin-tab-btn" onclick="switchAdminTab('users')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                        <button class="admin-tab-btn" onclick="switchAdminTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                    </div>
                    
                    <div id="admin-levels-tab" class="admin-tab-content active">
                        <h3>üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏</h3>
                        <div class="admin-section">
                            <h4>–ó–∞–≥—Ä—É–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</h4>
                            <input type="file" id="admin-level-upload" accept=".json" />
                            <button onclick="adminUploadLevel()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                        </div>
                        <div class="admin-section">
                            <h4>–£—Ä–æ–≤–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h4>
                            <div id="admin-user-levels-list"></div>
                        </div>
                    </div>
                    
                    <div id="admin-users-tab" class="admin-tab-content">
                        <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                        <div class="admin-section">
                            <h4>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h4>
                            <div id="admin-users-list"></div>
                        </div>
                    </div>
                    
                    <div id="admin-stats-tab" class="admin-tab-content">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="admin-section">
                            <p>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <strong id="admin-total-users">0</strong></p>
                            <p>–í—Å–µ–≥–æ —É—Ä–æ–≤–Ω–µ–π: <strong id="admin-total-levels">0</strong></p>
                            <p>–ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–≤–Ω–µ–π: <strong id="admin-completed-levels">0</strong></p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(panel);
            loadAdminData();
        }

        function closeAdminPanel() {
            const panel = document.getElementById('admin-panel-modal');
            if (panel) panel.remove();
        }

        function switchAdminTab(tabName) {
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('admin-' + tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        function loadAdminData() {
            loadUserLevels();
            loadUsersList();
            loadStats();
        }

        function loadUserLevels() {
            const userLevels = JSON.parse(localStorage.getItem('user_levels') || '[]');
            const list = document.getElementById('admin-user-levels-list');
            
            if (userLevels.length === 0) {
                list.innerHTML = '<p>–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π</p>';
                return;
            }
            
            list.innerHTML = userLevels.map((level, index) => `
                <div class="admin-level-item">
                    <strong>${level.name}</strong>
                    <p>–ê–≤—Ç–æ—Ä: ${level.author || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                    <p>–†–∞–∑–º–µ—Ä: ${level.gridSize}x${level.gridSize}</p>
                    <button onclick="adminDeleteLevel(${index})">–£–¥–∞–ª–∏—Ç—å</button>
                    <button onclick="adminDownloadLevel(${index})">–°–∫–∞—á–∞—Ç—å</button>
                </div>
            `).join('');
        }

        function loadUsersList() {
            const users = JSON.parse(localStorage.getItem('users_list') || '[]');
            const list = document.getElementById('admin-users-list');
            
            if (users.length === 0) {
                list.innerHTML = '<p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>';
                return;
            }
            
            list.innerHTML = users.map((user, index) => `
                <div class="admin-user-item">
                    <strong>${user.name}</strong>
                    <p>–£—Ä–æ–≤–µ–Ω—å: ${user.level}</p>
                    <p>–û—á–∫–∏: ${user.score}</p>
                    <p>–í—Ä–µ–º—è: ${user.lastActive}</p>
                    <button onclick="adminDeleteUser(${index})">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');
        }

        function loadStats() {
            const users = JSON.parse(localStorage.getItem('users_list') || '[]');
            const userLevels = JSON.parse(localStorage.getItem('user_levels') || '[]');
            
            document.getElementById('admin-total-users').textContent = users.length;
            document.getElementById('admin-total-levels').textContent = userLevels.length;
            
            let completedCount = 0;
            users.forEach(user => {
                if (user.completedLevels) {
                    completedCount += user.completedLevels.length;
                }
            });
            document.getElementById('admin-completed-levels').textContent = completedCount;
        }

        function adminUploadLevel() {
            const fileInput = document.getElementById('admin-level-upload');
            
            // –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            if (!fileInput.files || fileInput.files.length === 0) {
                fileInput.click();
                return;
            }
            
            const file = fileInput.files[0];
            
            if (!file) {
                alert('–í—ã–±–µ—Ä–∏ —Ñ–∞–π–ª!');
                return;
            }
            
            console.log('–ó–∞–≥—Ä—É–∂–∞—é —Ñ–∞–π–ª:', file.name);
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    console.log('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:', e.target.result);
                    
                    const levelData = JSON.parse(e.target.result);
                    
                    console.log('–†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', levelData);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Ä–æ–≤–Ω—è
                    if (!levelData.start || !levelData.exit) {
                        alert('‚ùå –û—à–∏–±–∫–∞: –≤ —Ñ–∞–π–ª–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—è "start" –∏ "exit"!');
                        return;
                    }
                    
                    if (!levelData.objects) {
                        levelData.objects = [];
                    }
                    
                    if (!levelData.gridSize) {
                        levelData.gridSize = 8;
                    }
                    
                    if (!levelData.name) {
                        levelData.name = file.name.replace('.json', '');
                    }
                    
                    levelData.author = playerName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                    levelData.uploadedAt = new Date().toISOString();
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                    const userLevels = JSON.parse(localStorage.getItem('user_levels') || '[]');
                    userLevels.push(levelData);
                    localStorage.setItem('user_levels', JSON.stringify(userLevels));
                    
                    console.log('–£—Ä–æ–≤–µ–Ω—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω. –í—Å–µ–≥–æ —É—Ä–æ–≤–Ω–µ–π:', userLevels.length);
                    
                    alert('‚úÖ –£—Ä–æ–≤–µ–Ω—å "' + levelData.name + '" –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!\n\n–ê–≤—Ç–æ—Ä: ' + levelData.author + '\n–†–∞–∑–º–µ—Ä: ' + levelData.gridSize + 'x' + levelData.gridSize);
                    
                    fileInput.value = '';
                    loadUserLevels();
                    loadStats();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', error);
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞:\n\n' + error.message + '\n\n–£–±–µ–¥–∏—Å—å, —á—Ç–æ —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π JSON —Ñ–∞–π–ª —É—Ä–æ–≤–Ω—è!');
                }
            };
            
            reader.onerror = function(error) {
                console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞!');
            };
            
            reader.readAsText(file);
        }

        function adminDeleteLevel(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å?')) {
                const userLevels = JSON.parse(localStorage.getItem('user_levels') || '[]');
                userLevels.splice(index, 1);
                localStorage.setItem('user_levels', JSON.stringify(userLevels));
                loadUserLevels();
            }
        }

        function adminDownloadLevel(index) {
            const userLevels = JSON.parse(localStorage.getItem('user_levels') || '[]');
            const level = userLevels[index];
            
            const blob = new Blob([JSON.stringify(level, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `level_${level.name}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function adminDeleteUser(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                const users = JSON.parse(localStorage.getItem('users_list') || '[]');
                users.splice(index, 1);
                localStorage.setItem('users_list', JSON.stringify(users));
                loadUsersList();
            }
        }

        function trackUser(name, level, score) {
            const users = JSON.parse(localStorage.getItem('users_list') || '[]');
            let user = users.find(u => u.name === name);
            
            if (!user) {
                user = {
                    name: name,
                    level: level,
                    score: score,
                    completedLevels: [],
                    lastActive: new Date().toLocaleString('ru-RU')
                };
                users.push(user);
            } else {
                user.level = level;
                user.score = score;
                user.lastActive = new Date().toLocaleString('ru-RU');
            }
            
            localStorage.setItem('users_list', JSON.stringify(users));
        }

        function trackCompletedLevel(playerName, levelNumber) {
            const users = JSON.parse(localStorage.getItem('users_list') || '[]');
            let user = users.find(u => u.name === playerName);
            
            if (user) {
                if (!user.completedLevels) {
                    user.completedLevels = [];
                }
                if (!user.completedLevels.includes(levelNumber)) {
                    user.completedLevels.push(levelNumber);
                }
                localStorage.setItem('users_list', JSON.stringify(users));
            }
        }
    </script>
</body>
</html>
